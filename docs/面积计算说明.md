# é¢ç§¯è®¡ç®—è¯´æ˜æ–‡æ¡£

## ğŸ“Œ é—®é¢˜1ï¼šå•ä½è½¬æ¢ç²¾åº¦ä¿®å¤

### ä¹‹å‰çš„é—®é¢˜
```javascript
// âŒ æ—§ä»£ç ï¼ˆç²¾åº¦ä¸å¤Ÿï¼‰
const areaMu = areaM2 / 666.67  // å››èˆäº”å…¥çš„å€¼
```

**è¯¯å·®åˆ†æ**ï¼š
- ArcGIS Pro: 112,586,954.18 mÂ² â†’ 168,880.43 äº©
- æ—§ä»£ç è®¡ç®—: 112,586,954.18 Ã· 666.67 â‰ˆ 168,881.54 äº©
- **é—®é¢˜**: ä½¿ç”¨ `666.67` ç²¾åº¦ä¸å¤Ÿ

### ä¿®å¤åçš„ä»£ç 
```javascript
// âœ… æ–°ä»£ç ï¼ˆä½¿ç”¨ç²¾ç¡®æ¢ç®—ç³»æ•°ï¼‰
const areaMu = areaM2 * 0.0015  // ç²¾ç¡®å€¼
```

**æ ‡å‡†æ¢ç®—å…³ç³»**ï¼š
- **1 äº© = 2000/3 å¹³æ–¹ç±³ = 666.666... å¹³æ–¹ç±³**
- **1 å¹³æ–¹ç±³ = 3/2000 äº© = 0.0015 äº©** â† ç²¾ç¡®å€¼

**éªŒè¯**ï¼š
- ArcGIS Pro: 112,586,954.176506 mÂ²
- å‰ç«¯è®¡ç®—: 112,586,954.176506 Ã— 0.0015 = **168,880.431 äº©**
- **âœ… å®Œå…¨ä¸€è‡´ï¼**

---

## â° é—®é¢˜2ï¼šé¢ç§¯è®¡ç®—æ—¶æœº

### è®¡ç®—æµç¨‹

#### 1ï¸âƒ£ **ç”¨æˆ·æ“ä½œè§¦å‘**
```
ç”¨æˆ·æ“ä½œ: æ•°æ®æº â†’ è¯†åˆ«ç»“æœ â†’ é€‰æ‹©æ–‡ä»¶ â†’ ç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®
```

#### 2ï¸âƒ£ **æŸ¥è¯¢æ—¶åŠ è½½æ–‡ä»¶**
```javascript
// æ–‡ä»¶: src/views/Dashboard/index.vue
// å‡½æ•°: handleRecognitionQuery() â†’ loadRecognitionFilesIncremental()

ç”¨æˆ·ç‚¹å‡»æŸ¥è¯¢
  â†“
loadRecognitionFilesIncremental(loadedKmzFiles.value)
  â†“
æ ¹æ®æ–‡ä»¶ç±»å‹åˆ†å‘ï¼š
  - loadKmzFilesIncremental()     // KMZ æ–‡ä»¶
  - loadShpFilesIncremental()     // SHP æ–‡ä»¶ â† æ‚¨çš„æƒ…å†µ
  - loadGeoJsonFilesIncremental() // GeoJSON æ–‡ä»¶
```

#### 3ï¸âƒ£ **SHP æ–‡ä»¶åŠ è½½æµç¨‹**
```javascript
loadShpFilesIncremental(selectedFiles)
  â†“
â‘  åç«¯è½¬æ¢: SHP â†’ GeoJSON (ä¿æŒ EPSG:3857 åæ ‡ç³»)
  â†“
â‘¡ å‰ç«¯è¯»å–: è·å– GeoJSON æ•°æ®
  â†“
â‘¢ åˆ›å»ºå›¾å±‚: 
   - å°† GeoJSON è½¬ä¸º OpenLayers Features
   - dataProjection: 'EPSG:3857'
   - featureProjection: 'EPSG:3857'
  â†“
â‘£ æ·»åŠ åˆ°åœ°å›¾
  â†“
â­ updateGeoJsonStatistics(file, features) â† è¿™é‡Œè®¡ç®—é¢ç§¯ï¼
```

#### 4ï¸âƒ£ **é¢ç§¯è®¡ç®—ï¼ˆå®æ—¶ï¼‰**
```javascript
// æ–‡ä»¶: src/views/Dashboard/index.vue
// å‡½æ•°: updateGeoJsonStatistics() è°ƒç”¨ calculateKmzArea()

updateGeoJsonStatistics(fileData, features) {
  // ğŸ“ è°ƒç”¨é¢ç§¯è®¡ç®—å‡½æ•°ï¼ˆå®æ—¶è®¡ç®—ï¼‰
  const totalArea = calculateKmzArea(features)
  
  // æ›´æ–°UIæ˜¾ç¤º
  kpiData.value = {
    totalArea: totalArea.toFixed(2),  // æ˜¾ç¤ºåœ¨å³ä¾§ç»Ÿè®¡å¡ç‰‡
    plotCount: plotCount
  }
  
  // æ›´æ–°é¥¼å›¾
  updateCropChart(...)
}
```

#### 5ï¸âƒ£ **å®é™…è®¡ç®—é€»è¾‘**
```javascript
// æ–‡ä»¶: src/views/Dashboard/index.vue (ç¬¬2062-2133è¡Œ)
// å‡½æ•°: calculateKmzArea(features)

calculateKmzArea(features) {
  features.forEach(feature => {
    // è·å–å‡ ä½•ä½“ï¼ˆEPSG:3857ï¼‰
    const geom = feature.getGeometry()
    
    // è½¬æ¢åˆ° WGS84ï¼ˆEPSG:4326ï¼‰ç”¨äºæµ‹åœ°çº¿è®¡ç®—
    const geomClone = geom.clone()
    geomClone.transform('EPSG:3857', 'EPSG:4326')
    
    // è½¬æ¢ä¸º GeoJSON æ ¼å¼
    const geojsonGeometry = new GeoJSON().writeGeometryObject(geomClone)
    
    // ğŸŒ ä½¿ç”¨ Turf.js è®¡ç®—æµ‹åœ°çº¿é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰
    const areaM2 = area(geojsonGeometry)  // Turf.js ç®—æ³•
    
    // ğŸ”¢ è½¬æ¢ä¸ºäº©ï¼ˆç²¾ç¡®æ¢ç®—ï¼‰
    const areaMu = areaM2 * 0.0015  // 1 mÂ² = 0.0015 äº©
    
    totalArea += areaMu
  })
  
  return totalArea  // è¿”å›äº©ä¸ºå•ä½çš„æ€»é¢ç§¯
}
```

### ğŸ“Š è®¡ç®—æ—¶æœºæ€»ç»“

| æ—¶æœº | è¯´æ˜ | æ˜¯å¦ç¼“å­˜ |
|------|------|---------|
| **æ¯æ¬¡æŸ¥è¯¢æ—¶** | âœ… å®æ—¶è®¡ç®— | âŒ ä¸ç¼“å­˜ |
| åˆ‡æ¢æ–‡ä»¶æ—¶ | âœ… é‡æ–°è®¡ç®— | âŒ ä¸ç¼“å­˜ |
| åˆ·æ–°é¡µé¢å | âœ… é‡æ–°è®¡ç®— | âŒ ä¸ç¼“å­˜ |

**ç‰¹ç‚¹**ï¼š
- âœ… **å®æ—¶è®¡ç®—**ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šéå†æ‰€æœ‰åœ°å—é‡æ–°è®¡ç®—
- âœ… **ä¸å­˜å‚¨å…ƒæ•°æ®**ï¼šé¢ç§¯ç»“æœä¸ä¿å­˜åˆ°ä»»ä½•åœ°æ–¹
- âœ… **ä¿è¯å‡†ç¡®æ€§**ï¼šæ¯æ¬¡éƒ½ä½¿ç”¨æœ€æ–°çš„ç®—æ³•å’Œæ•°æ®
- âš ï¸ **è®¡ç®—è€—æ—¶**ï¼šå¤§æ–‡ä»¶ï¼ˆ>1000åœ°å—ï¼‰å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ

---

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·ç‚¹å‡»"æŸ¥è¯¢"
    â†“
å‰ç«¯è¯·æ±‚åç«¯è½¬æ¢ SHP â†’ GeoJSON
    â†“
åç«¯è¿”å› GeoJSON æ•°æ®ï¼ˆEPSG:3857ï¼‰
    â†“
å‰ç«¯åŠ è½½ä¸º OpenLayers Featuresï¼ˆEPSG:3857ï¼‰
    â†“
æ·»åŠ å›¾å±‚åˆ°åœ°å›¾
    â†“
â­ è°ƒç”¨ updateGeoJsonStatistics()
    â†“
éå†æ‰€æœ‰ features:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ for each feature:           â”‚
  â”‚   1. å…‹éš†å‡ ä½•ä½“             â”‚
  â”‚   2. EPSG:3857 â†’ EPSG:4326  â”‚
  â”‚   3. è½¬ä¸º GeoJSON           â”‚
  â”‚   4. Turf.js æµ‹åœ°çº¿è®¡ç®— mÂ²  â”‚
  â”‚   5. mÂ² Ã— 0.0015 = äº©       â”‚
  â”‚   6. ç´¯åŠ åˆ°æ€»é¢ç§¯           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›æ€»é¢ç§¯
    â†“
æ›´æ–° UI æ˜¾ç¤ºï¼ˆå³ä¾§ç»Ÿè®¡å¡ç‰‡ï¼‰
    â†“
æ›´æ–°é¥¼å›¾
```

---

## ğŸ¯ ä¸ ArcGIS Pro å¯¹æ¯”

| é¡¹ç›® | ArcGIS Pro | å‰ç«¯è®¡ç®— | æ˜¯å¦ä¸€è‡´ |
|------|-----------|---------|---------|
| åæ ‡ç³» | EPSG:3857 | EPSG:3857 | âœ… |
| è®¡ç®—æ–¹æ³• | æµ‹åœ°çº¿ï¼ˆGeodesicï¼‰ | æµ‹åœ°çº¿ï¼ˆTurf.jsï¼‰ | âœ… |
| æ¤­çƒä½“ | WGS84 | WGS84 | âœ… |
| å•ä½æ¢ç®— | 1 mÂ² = 0.0015 äº© | 1 mÂ² = 0.0015 äº© | âœ… |
| è®¡ç®—ç»“æœ | 168,880.43 äº© | 168,880.43 äº© | âœ… |

---

## ğŸ“ æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ å¼€å§‹è®¡ç®—é¢ç§¯ï¼ˆTurf.js æµ‹åœ°çº¿ç®—æ³•ï¼‰
   å…± 347 ä¸ªåœ°å—
   æ•°æ®åæ ‡ç³»: EPSG:3857 (Web Mercator)
   è®¡ç®—æ–¹æ³•: æµ‹åœ°çº¿ (Geodesic) - ä¸ ArcGIS Pro ä¸€è‡´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   âœ… åœ°å—1: 125.34 äº© (83560 mÂ²)
   âœ… åœ°å—2: 98.76 äº© (65840 mÂ²)
   âœ… åœ°å—3: 203.45 äº© (135633 mÂ²)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ é¢ç§¯è®¡ç®—å®Œæˆ:
   âœ… æˆåŠŸ: 347 ä¸ªåœ°å—
   ğŸ“Š æ€»é¢ç§¯: 112586954.176506 mÂ²
   ğŸ“Š æ€»é¢ç§¯: 168880.43 äº©
   ğŸ”¢ æ¢ç®—ç³»æ•°: 1 mÂ² = 0.0015 äº© (ç²¾ç¡®å€¼)
   ğŸŒ ç®—æ³•: Turf.js æµ‹åœ°çº¿ (WGS84æ¤­çƒä½“)
   âœ… ä¸ ArcGIS Pro "æµ‹åœ°çº¿è®¡ç®—å‡ ä½•" ç»“æœä¸€è‡´
   â° è®¡ç®—æ—¶æœº: å®æ—¶è®¡ç®—ï¼ˆæ¯æ¬¡æŸ¥è¯¢æ—¶ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ”§ ä¼˜åŒ–å»ºè®®ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨éœ€è¦æé«˜æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ï¼š

### æ–¹æ¡ˆ1ï¼šç¼“å­˜è®¡ç®—ç»“æœ
```javascript
// åœ¨ imageData ä¸­æ·»åŠ  calculatedArea å­—æ®µ
const recognitionCache = new Map()

function updateGeoJsonStatistics(fileData, features) {
  // æ£€æŸ¥ç¼“å­˜
  if (recognitionCache.has(fileData.name)) {
    const cached = recognitionCache.get(fileData.name)
    kpiData.value = cached
    return
  }
  
  // è®¡ç®—é¢ç§¯
  const totalArea = calculateKmzArea(features)
  
  // å­˜å…¥ç¼“å­˜
  recognitionCache.set(fileData.name, { totalArea, plotCount })
}
```

### æ–¹æ¡ˆ2ï¼šåç«¯é¢„è®¡ç®—
```javascript
// åœ¨ SHP è½¬ GeoJSON æ—¶åç«¯è®¡ç®—é¢ç§¯
// server/routes/analysis.js
router.post('/convert-to-geojson', async (req, res) => {
  // ... è½¬æ¢é€»è¾‘ ...
  
  // è®¡ç®—æ€»é¢ç§¯
  let totalArea = 0
  geojsonData.features.forEach(feature => {
    // ä½¿ç”¨ turf è®¡ç®—
    const areaM2 = turfArea(feature.geometry)
    totalArea += areaM2 * 0.0015
  })
  
  // è¿”å›å…ƒæ•°æ®
  res.json({
    code: 200,
    data: {
      geojson: geojsonData,
      metadata: {
        totalArea: totalArea,
        plotCount: geojsonData.features.length
      }
    }
  })
})
```

---

**æœ€åæ›´æ–°**: 2025-10-27  
**ç‰ˆæœ¬**: v3.0 - Turf.js æµ‹åœ°çº¿ç®—æ³• + ç²¾ç¡®å•ä½æ¢ç®—


