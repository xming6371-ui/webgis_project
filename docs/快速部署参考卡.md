# ğŸš€ å¿«é€Ÿéƒ¨ç½²å‚è€ƒå¡

> å·²ç†Ÿæ‚‰Dockerçš„ç”¨æˆ·ä¸“ç”¨ï¼Œé€‚åˆå¿«é€ŸæŸ¥é˜…

---

## ä¸€ã€å‰ç½®å‡†å¤‡

### æœåŠ¡å™¨è¦æ±‚
- **ç³»ç»Ÿ**ï¼šUbuntu 22.04 LTS
- **é…ç½®**ï¼šæœ€å°‘ 2æ ¸4Gï¼Œæ¨è 2æ ¸8G
- **å¸¦å®½**ï¼šæœ€å°‘ 5M
- **å¼€æ”¾ç«¯å£**ï¼š22, 80, 443

### åŸŸåï¼ˆå¯é€‰ï¼‰
- è´­ä¹°åŸŸåå¹¶å®Œæˆå®åè®¤è¯
- æ·»åŠ  A è®°å½•æŒ‡å‘æœåŠ¡å™¨ IP

---

## äºŒã€æœåŠ¡å™¨åˆå§‹åŒ–

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt-get update && sudo apt-get upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt-get install -y curl wget git vim

# é…ç½®é˜²ç«å¢™
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

---

## ä¸‰ã€å®‰è£…Docker

```bash
# ä¸€é”®å®‰è£…
curl -fsSL https://get.docker.com | bash

# å¯åŠ¨æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# éªŒè¯
docker --version
docker compose version
```

---

## å››ã€éƒ¨ç½²é¡¹ç›®

```bash
# 1. å…‹éš†é¡¹ç›®
cd /root
git clone <your-repo-url> webgis_project
cd webgis_project

# 2. åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p public/data
chmod -R 755 public/data

# 3. å¯åŠ¨æœåŠ¡ï¼ˆé¦–æ¬¡å¯åŠ¨éœ€10-20åˆ†é’Ÿï¼‰
docker compose up -d --build

# 4. æŸ¥çœ‹çŠ¶æ€
docker compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

---

## äº”ã€é…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰

```bash
# 1. DNSè§£æï¼šåœ¨åŸŸåæ§åˆ¶å°æ·»åŠ  A è®°å½•

# 2. ä¿®æ”¹ Nginx é…ç½®
nano nginx.conf
# ä¿®æ”¹ server_name localhost; ä¸ºä½ çš„åŸŸå

# 3. é‡å¯å‰ç«¯
docker compose restart frontend
```

---

## å…­ã€é…ç½®HTTPSï¼ˆå¯é€‰ï¼‰

```bash
# 1. å®‰è£… Certbot
sudo apt-get install -y certbot

# 2. åœæ­¢å‰ç«¯ï¼ˆé‡Šæ”¾80ç«¯å£ï¼‰
docker compose stop frontend

# 3. è·å–è¯ä¹¦
sudo certbot certonly --standalone -d ä½ çš„åŸŸå -m ä½ çš„é‚®ç®± --agree-tos

# 4. ä¿®æ”¹ docker-compose.yml
# åœ¨ frontend çš„ volumes ä¸‹æ·»åŠ ï¼š
# - /etc/letsencrypt:/etc/letsencrypt:ro

# 5. ä¿®æ”¹ nginx.confï¼ˆå‚è€ƒå®Œæ•´æŒ‡å—ï¼‰

# 6. é‡å¯æœåŠ¡
docker compose up -d --build

# 7. è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 0 1 * * certbot renew --quiet && docker compose -f /root/webgis_project/docker-compose.yml restart frontend
```

---

## ä¸ƒã€å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨
docker compose up -d

# åœæ­¢
docker compose down

# é‡å¯
docker compose restart

# é‡æ–°æ„å»º
docker compose up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹çŠ¶æ€
docker compose ps

# è¿›å…¥å®¹å™¨
docker exec -it webgis-backend sh

# å¤‡ä»½æ•°æ®
tar -czf backup-$(date +%Y%m%d).tar.gz public/data/

# æ¸…ç†Docker
docker system prune -a
```

---

## å…«ã€é¡¹ç›®æ–‡ä»¶ç»“æ„

```
webgis_project/
â”œâ”€â”€ Dockerfile              # å‰ç«¯é•œåƒ
â”œâ”€â”€ docker-compose.yml      # æœåŠ¡ç¼–æ’
â”œâ”€â”€ nginx.conf             # Nginxé…ç½®
â”œâ”€â”€ .dockerignore          # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ Dockerfile         # åç«¯é•œåƒ
â”‚   â””â”€â”€ .dockerignore
â”œâ”€â”€ public/data/           # æ•°æ®ç›®å½•ï¼ˆæŒä¹…åŒ–ï¼‰
â””â”€â”€ docs/                  # æ–‡æ¡£
```

---

## ä¹ã€éªŒè¯éƒ¨ç½²

```bash
# åç«¯å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# å‰ç«¯è®¿é—®
curl http://localhost

# æµè§ˆå™¨è®¿é—®
http://æœåŠ¡å™¨IP
# æˆ–
http://ä½ çš„åŸŸå
```

---

## åã€æ•…éšœæ’æŸ¥

| é—®é¢˜ | å‘½ä»¤ |
|-----|------|
| æŸ¥çœ‹å®¹å™¨çŠ¶æ€ | `docker compose ps` |
| æŸ¥çœ‹æ—¥å¿— | `docker compose logs -f` |
| é‡å¯æœåŠ¡ | `docker compose restart` |
| æ¸…ç†ç¼“å­˜ | `docker system prune -a` |
| æŸ¥çœ‹ç«¯å£å ç”¨ | `sudo netstat -tulpn \| grep :80` |
| æŸ¥çœ‹ç£ç›˜ç©ºé—´ | `df -h` |
| è¿›å…¥å®¹å™¨è°ƒè¯• | `docker exec -it webgis-backend sh` |

---

## åä¸€ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

```bash
# 1. é™åˆ¶å®¹å™¨èµ„æºï¼ˆä¿®æ”¹ docker-compose.ymlï¼‰
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

# 2. é…ç½® Docker æ—¥å¿—è½®è½¬
# ä¿®æ”¹ /etc/docker/daemon.json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}

# 3. å®šæœŸæ¸…ç†
docker system prune -a --volumes
```

---

## åäºŒã€å®‰å…¨å»ºè®®

```bash
# 1. ä¿®æ”¹ SSH ç«¯å£ï¼ˆå¯é€‰ï¼‰
sudo vim /etc/ssh/sshd_config
# ä¿®æ”¹ Port 22 ä¸ºå…¶ä»–ç«¯å£

# 2. ç¦ç”¨ root ç™»å½•ï¼ˆå¯é€‰ï¼‰
# PermitRootLogin no

# 3. é…ç½® fail2ban é˜²çˆ†ç ´
sudo apt-get install fail2ban

# 4. å®šæœŸæ›´æ–°
sudo apt-get update && sudo apt-get upgrade -y
docker compose pull
docker compose up -d --build
```

---

## ğŸ“ å¿«é€Ÿå¸®åŠ©

- **å®Œæ•´æŒ‡å—**ï¼š`docs/Dockeréƒ¨ç½²å®Œå…¨æŒ‡å—-é›¶åŸºç¡€ç‰ˆ.md`
- **é¡¹ç›®æ–‡æ¡£**ï¼š`docs/README.md`
- **åç«¯å¥åº·æ£€æŸ¥**ï¼š`http://IP:8080/health`

---

**éƒ¨ç½²æ—¶é—´çº¿ï¼š**
- â±ï¸ æœåŠ¡å™¨åˆå§‹åŒ–ï¼š5-10åˆ†é’Ÿ
- â±ï¸ å®‰è£…Dockerï¼š5åˆ†é’Ÿ
- â±ï¸ é¦–æ¬¡æ„å»ºï¼š10-20åˆ†é’Ÿ
- â±ï¸ é…ç½®åŸŸåï¼š10åˆ†é’Ÿ-2å°æ—¶ï¼ˆDNSç”Ÿæ•ˆï¼‰
- â±ï¸ é…ç½®HTTPSï¼š5åˆ†é’Ÿ

**æ€»è®¡ï¼š30åˆ†é’Ÿ - 2.5å°æ—¶**

